services:
  claude-offline-cpu:
    build:
      context: .
      dockerfile: cpu.Dockerfile
    container_name: claude-offline-cpu
    ports:
      - "${PORT}:${PORT}"
    volumes:
      - ./models:/app/models
    command: >
      --host 0.0.0.0
      --port ${PORT}
      --model /app/models/${MODEL_PATH}
      --alias "${MODEL_ALIAS}"
      --ctx-size ${CTX_SIZE}
      --threads ${THREADS}
      --n-gpu-layers ${GPU_LAYERS}
    restart: unless-stopped
    env_file:
      - .env

  claude-offline-gpu:
    container_name: claude-offline-gpu
    build:
      context: .
      dockerfile: gpu.Dockerfile
    ports:
      - "${PORT}:${PORT}"
    volumes:
      - ./models:/app/models
    gpus:
      - driver: nvidia
        count: all
        capabilities: [gpu]
    command: >
      --host 0.0.0.0
      --port ${PORT}
      --model /app/models/${MODEL_PATH}
      --alias "${MODEL_ALIAS}"
      --ctx-size ${CTX_SIZE}
      --threads ${THREADS}
      --n-gpu-layers ${GPU_LAYERS}
    restart: unless-stopped
    env_file:
      - .env
